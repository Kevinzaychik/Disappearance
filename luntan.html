<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯†æ’•å¡æ‰˜å°¼å…‹å¤§å­¦ | å­¦ç”Ÿè®ºå›</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* åŸºç¡€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        body {
            background-color: #f8f8f8;
            color: #333;
            line-height: 1.6;
        }
        a {
            text-decoration: none;
            color: inherit;
            cursor: pointer;
        }
        /* é¡¶éƒ¨å¯¼èˆªæ  */
        .header {
            background-color: #fff;
            padding: 1rem 5%;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            display: flex;
            align-items: baseline;
        }
        .logo-main {
            font-family: 'Cinzel Decorative', cursive;
            font-size: 1.8rem;
            margin-left: 0.5rem;
            color: #333;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
        }
        .nav {
            display: flex;
            align-items: center;
        }
        .nav a {
            margin-left: 2rem;
            font-size: 0.95rem;
            transition: color 0.3s ease;
        }
        .nav a:hover {
            color: #777;
        }
        /* æœç´¢æ¡†æ ·å¼ */
        .search-box {
            display: flex;
            align-items: center;
            background: white;
            border-radius: 4px;
            padding: 8px 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            margin-right: 2rem;
        }
        .search-box input {
            border: none;
            outline: none;
            padding: 5px;
            width: 180px;
            font-size: 0.9rem;
        }
        .search-box i {
            color: #777;
            cursor: pointer;
        }
        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 20px;
        }
        /* ç‰ˆå—é¢æ¿ - æ ¸å¿ƒé˜´å½±æ•ˆæœåœ¨æ­¤å®ç° */
        .forum-panel {
            background-color: #fff;
            border-radius: 8px;
            margin-bottom: 2rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            /* é€šè¿‡å åŠ é˜´å½±åˆ›é€ é«˜ä½å±‚æ¬¡æ„Ÿ */
            box-shadow: 0 2px 4px rgba(0,0,0,0.04),
                        0 4px 8px rgba(0,0,0,0.04),
                        0 8px 16px rgba(0,0,0,0.04);
        }
        /* ä¸åŒå±‚çº§çš„é˜´å½±ï¼Œæ¨¡æ‹Ÿé«˜ä½å·® */
        .panel-level-1 { box-shadow: 0 2px 6px rgba(0,0,0,0.06), 0 6px 12px rgba(0,0,0,0.06), 0 12px 24px rgba(0,0,0,0.06); }
        .panel-level-2 { box-shadow: 0 3px 8px rgba(0,0,0,0.07), 0 8px 16px rgba(0,0,0,0.07), 0 16px 32px rgba(0,0,0,0.07); }
        .panel-level-3 { box-shadow: 0 4px 10px rgba(0,0,0,0.08), 0 10px 20px rgba(0,0,0,0.08), 0 20px 40px rgba(0,0,0,0.08); }

        .forum-panel:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08),
                        0 8px 24px rgba(0,0,0,0.08),
                        0 16px 40px rgba(0,0,0,0.08);
        }
        .panel-header {
            padding: 1.5rem;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .panel-title {
            font-size: 1.3rem;
            font-weight: 600;
        }
        .panel-more {
            font-size: 0.85rem;
            color: #777;
        }
        .panel-body {
            padding: 1.5rem;
        }
        /* å¸–å­åˆ—è¡¨ */
        .post-list {
            list-style: none;
        }
        .post-item {
            display: flex;
            padding: 1rem 0;
            border-bottom: 1px solid #f5f5f5;
        }
        .post-item:last-child {
            border-bottom: none;
        }
        .post-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            flex-shrink: 0;
        }
        .post-content {
            flex-grow: 1;
        }
        .post-title {
            font-weight: 600;
            margin-bottom: 0.3rem;
            display: block;
        }
        .post-meta {
            font-size: 0.85rem;
            color: #888;
        }
        .post-stats {
            text-align: right;
            font-size: 0.85rem;
            color: #888;
            min-width: 100px;
        }
        /* é¡µè„š */
        .footer {
            text-align: center;
            padding: 2rem;
            color: #888;
            font-size: 0.9rem;
            background-color: #fff;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.03);
            margin-top: 3rem;
        }
        
        /* ç™»å½•/æ³¨å†Œå¼¹çª— */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .login-modal {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 400px;
            max-width: 90%;
            padding: 2rem;
            position: relative;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        .modal-overlay.active .login-modal {
            transform: translateY(0);
        }
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1.5rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #888;
        }
        .login-modal h2 {
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 600;
        }
        .form-group {
            margin-bottom: 1.2rem;
            position: relative;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            color: #555;
        }
        .form-group input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            font-size: 1rem;
        }
        .form-group input:focus {
            outline: none;
            border-color: #888;
        }
        .form-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
        }
        .remember-me {
            display: flex;
            align-items: center;
        }
        .remember-me input {
            margin-right: 0.5rem;
        }
        .forgot-password {
            color: #777;
        }
        .login-btn {
            width: 100%;
            padding: 0.8rem;
            background-color: #333;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .login-btn:hover {
            background-color: #555;
        }
        .register-link {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 0.9rem;
        }
        .register-link a {
            color: #333;
            font-weight: 600;
        }
        .error-message {
            color: #e74c3c;
            font-size: 0.8rem;
            margin-top: 5px;
            display: none;
        }
        
        /* éª°å­æ’ä»¶æ ·å¼ */
        /* é‡ç½®æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* éª°å­æ’ä»¶æ ·å¼ */
        .pixel-dice-plugin {
            font-family: 'Courier New', monospace;
            background-color: #0a0a0a;
            border: 2px solid #333;
            padding: 15px;
            border-radius: 8px;
            max-width: 320px;
            color: #e0e0e0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            display: none;
        }
        
        /* é¡µé¢å®¹å™¨ */
        .plugin-pages {
            display: flex;
            width: 100%;
            transition: transform 0.5s ease-in-out;
        }
        
        .plugin-page {
            width: 100%;
            min-height: 280px;
            padding: 0;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }
        
        .page-switched .plugin-pages {
            transform: translateX(-100%);
        }
        
        /* å¯¼èˆªæŒ‰é’® */
        .nav-btn {
            position: absolute;
            top: 5px;
            background-color: #333;
            color: #e0e0e0;
            border: 1px solid #555;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s ease;
            z-index: 10;
        }
        
        .nav-btn:hover {
            background-color: #444;
            border-color: #00ff00;
        }
        
        .collapse-btn {
            width: 20px;
            height: 20px;
            right: 5px;
        }
        
        .next-btn {
            width: 20px;
            height: 20px;
            right: 30px;
        }
        
        .prev-btn {
            width: 20px;
            height: 20px;
            right: 55px;
            display: none;
        }
        
        /* é¡µé¢ä¸€ï¼šéª°å­é¡µé¢æ ·å¼ */
        .dice-page {
            padding: 15px;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .item-display {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }
        
        .dice-icon {
            width: 50px;
            height: 50px;
            border: 2px solid #555;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
            overflow: hidden;
        }
        
        .dice-icon.activated {
            border-color: #00ff00;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }
        
        .dice-icon.cooldown {
            border-color: #ff9900;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 5px rgba(255, 153, 0, 0.3); }
            50% { box-shadow: 0 0 15px rgba(255, 153, 0, 0.5); }
            100% { box-shadow: 0 0 5px rgba(255, 153, 0, 0.3); }
        }
        
        .dice-image {
            width: 80%;
            height: 80%;
            object-fit: contain;
            image-rendering: pixelated;
        }
        
        .item-name {
            font-size: 1rem;
            font-weight: bold;
            color: #00ff00;
            flex-grow: 1;
        }
        
        .cooldown-info {
            font-size: 0.8rem;
            color: #ff9900;
            margin-left: 10px;
            font-weight: normal;
        }
        
        /* æ­£æ–¹å½¢å›¾ç‰‡åŒºåŸŸ */
        .dice-image-container {
            width: 100%;
            height: 120px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 15px 0;
            overflow: hidden;
            border-radius: 8px;
            border: 1px solid #333;
            background-color: #111;
        }
        
        .dice-main-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .dice-main-image:hover {
            transform: scale(1.05);
        }
        
        .use-btn {
            width: 100%;
            padding: 8px;
            background-color: #00aa00;
            color: white;
            border: none;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: auto;
            position: relative;
            overflow: hidden;
        }
        
        .use-btn:hover:not(:disabled) {
            background-color: #00cc00;
        }
        
        .use-btn:disabled {
            background-color: #333;
            color: #777;
            cursor: not-allowed;
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255, 153, 0, 0.1) 10px,
                rgba(255, 153, 0, 0.1) 20px
            );
        }
        
        .cooldown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            color: #ff9900;
            font-weight: bold;
        }
        
        /* é¡µé¢äºŒï¼šSANå€¼é¡µé¢æ ·å¼ */
        .san-page {
            padding: 15px;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .page-title {
            font-size: 1rem;
            font-weight: bold;
            color: #00ff00;
            margin-bottom: 20px;
            text-align: center;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }
        
        .investigator-info {
            margin-bottom: 25px;
        }
        
        .info-group {
            margin-bottom: 15px;
        }
        
        .info-label {
            display: block;
            margin-bottom: 5px;
            color: #aaa;
            font-size: 0.8rem;
        }
        
        .info-value {
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .info-text {
            color: #00ff00;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        .san-display {
            margin-top: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .san-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #00ff00;
            font-size: 0.9rem;
        }
        
        .san-value {
            font-weight: bold;
            color: #00ff00;
        }
        
        .san-progress-container {
            width: 100%;
            height: 20px;
            background-color: #111;
            border: 1px solid #333;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .san-progress-bar {
            height: 100%;
            background: linear-gradient(to right, #00ff00, #00cc00);
            width: 100%;
            transition: width 0.5s ease;
            position: relative;
        }
        
        .san-progress-text {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            font-weight: bold;
            font-size: 0.8rem;
        }
        
        /* å¯¹è¯æ¡†æ ·å¼ */
        .dialog-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }
        
        .dialog-content {
            background-color: #0a0a0a;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #00ff00;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 0 25px rgba(0, 255, 0, 0.4);
            font-family: 'Courier New', monospace;
        }
        
        .dialog-text {
            color: #00ff00;
            font-size: 1rem;
            line-height: 1.5;
            min-height: 60px;
            white-space: pre-wrap;
            margin-bottom: 15px;
        }
        
        /* ä¸åŒæˆåŠŸç­‰çº§çš„æ–‡å­—é¢œè‰² */
        .critical-success-text {
            color: #00ff00;
            font-weight: bold;
        }
        
        .critical-failure-text {
            color: #ff0000;
            font-weight: bold;
        }
        
        .extreme-success-text {
            color: #00ccff;
        }
        
        .hard-success-text {
            color: #0099ff;
        }
        
        .regular-success-text {
            color: #00ff00;
        }
        
        .failure-text {
            color: #ff9900;
        }
        
        .cursor {
            display: inline-block;
            width: 6px;
            height: 1rem;
            background-color: #00ff00;
            margin-left: 2px;
            animation: blink 1s infinite;
            vertical-align: text-bottom;
        }
        
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .dialog-close {
            background-color: #00ff00;
            color: #000;
            border: none;
            padding: 6px 15px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            border-radius: 4px;
            float: right;
            font-size: 0.9rem;
        }
        
        .dialog-close:hover {
            background-color: #00cc00;
        }
        
        /* å·¥å…·æç¤ºæ ·å¼ */
        .dice-tooltip {
            position: fixed;
            background-color: rgba(10, 10, 10, 0.95);
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 10px;
            border-radius: 6px;
            max-width: 280px;
            z-index: 10001;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            line-height: 1.3;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.7);
            pointer-events: none;
        }
        
        .dice-tooltip strong {
            color: #00ff00;
        }
        
        .epic-text {
            color: #9370db;
            font-weight: bold;
        }
        
        .warning-text {
            color: #00ff00;
            font-style: italic;
        }
        
        /* æ’ä»¶å®¹å™¨æ ·å¼ - å³ä¸‹è§’å›ºå®šå®šä½ */
        #dicePluginContainer {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 320px;
        }
        
        /* æŠ˜å åçš„åœ†å½¢å›¾æ ‡ */
        .dice-minimized {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: #0a0a0a;
            border: 2px solid #333;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
        }
        
        .dice-minimized:hover {
            border-color: #00ff00;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }
        
        .dice-minimized .expand-icon {
            color: #e0e0e0;
            font-size: 24px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .dice-minimized:hover .expand-icon {
            color: #00ff00;
            transform: scale(1.2);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .nav {
                display: none;
            }
            .post-stats {
                display: none;
            }
            .search-box {
                margin-right: 0;
            }
            .search-box input {
                width: 150px;
            }
            
            #dicePluginContainer {
                position: fixed;
                bottom: 10px;
                right: 10px;
                left: 10px;
                max-width: calc(100% - 20px);
            }
            
            .dice-minimized {
                bottom: 10px;
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="header">
        <div class="logo">
            å¯†æ’•å¡æ‰˜å°¼å…‹å¤§å­¦<span class="logo-main">å­¦ç”Ÿè®ºå›</span>
        </div>
        <nav class="nav">
            <div class="search-box">
                <i class="fas fa-search" id="search-icon"></i>
                <input type="text" id="search-input" placeholder="æœç´¢å¸–å­ã€ç”¨æˆ·...">
            </div>
            <a href="#">é¦–é¡µ</a>
            <a href="#" class="require-login">ç‰ˆå—</a>
            <a href="#" class="require-login">çƒ­é—¨</a>
            <a href="#" id="login-link">ç™»å½•/æ³¨å†Œ</a>
        </nav>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <div class="container">
        <!-- å­¦æœ¯è®¨è®ºåŒº -->
        <div class="forum-panel panel-level-1">
            <div class="panel-header">
                <h2 class="panel-title">å­¦æœ¯è®¨è®ºåŒº</h2>
                <a href="#" class="panel-more require-login">æ›´å¤š</a>
            </div>
            <div class="panel-body">
                <ul class="post-list">
                    <li class="post-item">
                        <div class="post-icon">ğŸ“š</div>
                        <div class="post-content">
                            <a href="#" class="post-title" id="stickied-post">ã€ç½®é¡¶ã€‘æˆ‘æ ¡æˆåŠŸæ²»æ„ˆç™Œç—‡æ™šæœŸä¸€ä¾‹ã€‚æ­å–œï¼</a>
                            <div class="post-meta">ä½œè€…: armitage Â· å‘è¡¨äº: 1ä¸ªæœˆå‰ Â· æœ€åå›å¤: 1å°æ—¶å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 24<br>æµè§ˆ: 186
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸ”¬</div>
                        <div class="post-content">
                            <a href="#" class="post-title">è€ƒå¤å­¦ç³»ç”°é‡è°ƒæŸ¥åˆ†äº« - 2025å¹´å¤å­£</a>
                            <div class="post-meta">ä½œè€…: danforth Â· å‘è¡¨äº: 5å°æ—¶å‰ Â· æœ€åå›å¤: 10åˆ†é’Ÿå‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 42<br>æµè§ˆ: 312
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸ§ª</div>
                        <div class="post-content">
                            <a href="#" class="post-title">åŒ–å­¦ç³»å®éªŒå®¤å®‰å…¨å®ˆåˆ™ä¿®è®¢ç‰ˆè®¨è®º</a>
                            <div class="post-meta">ä½œè€…: west Â· å‘è¡¨äº: 1å¤©å‰ Â· æœ€åå›å¤: 5å°æ—¶å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 18<br>æµè§ˆ: 156
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸ“–</div>
                        <div class="post-content">
                            <a href="#" class="post-title">ä¸­ä¸–çºªæ‹‰ä¸è¯­æ–‡çŒ®ç¿»è¯‘å°ç»„æ‹›å‹Ÿæˆå‘˜</a>
                            <div class="post-meta">ä½œè€…: blake Â· å‘è¡¨äº: 2å¤©å‰ Â· æœ€åå›å¤: 1å¤©å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 32<br>æµè§ˆ: 278
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸ”</div>
                        <div class="post-content">
                            <a href="#" class="post-title">å…³äºé˜¿å¡å§†åœ°åŒºæ°‘é—´ä¼ è¯´çš„è°ƒæŸ¥</a>
                            <div class="post-meta">ä½œè€…: pabodie Â· å‘è¡¨äº: 3å¤©å‰ Â· æœ€åå›å¤: 2å¤©å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 27<br>æµè§ˆ: 301
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸ“Š</div>
                        <div class="post-content">
                            <a href="#" class="post-title">æ•°å­¦ç³»é«˜ç»´å‡ ä½•ç ”ç©¶å°ç»„é˜¶æ®µæ€§æˆæœå±•ç¤º</a>
                            <div class="post-meta">ä½œè€…: dyer Â· å‘è¡¨äº: 4å¤©å‰ Â· æœ€åå›å¤: 1å¤©å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 41<br>æµè§ˆ: 389
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <!-- æ ¡å›­ç”Ÿæ´» -->
        <div class="forum-panel panel-level-2">
            <div class="panel-header">
                <h2 class="panel-title">æ ¡å›­ç”Ÿæ´»</h2>
                <a href="#" class="panel-more require-login">æ›´å¤š</a>
            </div>
            <div class="panel-body">
                <ul class="post-list">
                    <li class="post-item">
                        <div class="post-icon">ğŸ›ï¸</div>
                        <div class="post-content">
                            <a href="#" class="post-title">å¥¥æ©å›¾ä¹¦é¦†åœ£è¯å‡æœŸæœŸé—´å¼€æ”¾æ—¶é—´è°ƒæ•´é€šçŸ¥</a>
                            <div class="post-meta">ä½œè€…: admin Â· å‘è¡¨äº: 1å¤©å‰ Â· æœ€åå›å¤: 5å°æ—¶å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 15<br>æµè§ˆ: 203
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸ½ï¸</div>
                        <div class="post-content">
                            <a href="#" class="post-title">å…³äºé£Ÿå ‚å¼•å…¥æ–°ä¾›åº”å•†çš„æ„è§å¾é›†</a>
                            <div class="post-meta">ä½œè€…: willet Â· å‘è¡¨äº: 2å¤©å‰ Â· æœ€åå›å¤: 3å°æ—¶å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 67<br>æµè§ˆ: 498
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸ </div>
                        <div class="post-content">
                            <a href="#" class="post-title">ä¸œåŒºå®¿èˆæ¥¼çƒ­æ°´ä¾›åº”é—®é¢˜åé¦ˆä¸è§£å†³æ–¹æ¡ˆ</a>
                            <div class="post-meta">ä½œè€…: gardner Â· å‘è¡¨äº: 3å¤©å‰ Â· æœ€åå›å¤: 2å¤©å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 38<br>æµè§ˆ: 312
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸ­</div>
                        <div class="post-content">
                            <a href="#" class="post-title">æˆå‰§ç¤¾ç§‹å­£æ¼”å‡ºã€Šé»„è¡£ä¹‹ç‹ã€‹æ¼”å‘˜æ‹›å‹Ÿ</a>
                            <div class="post-meta">ä½œè€…: castaigne Â· å‘è¡¨äº: 4å¤©å‰ Â· æœ€åå›å¤: 1å¤©å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 52<br>æµè§ˆ: 421
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸšŒ</div>
                        <div class="post-content">
                            <a href="#" class="post-title">æ ¡è½¦æ—¶åˆ»è¡¨ç§‹å­£è°ƒæ•´æ–¹æ¡ˆå…¬ç¤º</a>
                            <div class="post-meta">ä½œè€…: transport Â· å‘è¡¨äº: 5å¤©å‰ Â· æœ€åå›å¤: 3å¤©å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 24<br>æµè§ˆ: 287
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸ“…</div>
                        <div class="post-content">
                            <a href="#" class="post-title">å¯†å¤§ä¼ ç»ŸèŠ‚æ—¥"æ˜Ÿä¹‹æ™ºæ…§èŠ‚"å³å°†å¼€å¹•</a>
                            <div class="post-meta">ä½œè€…: dewey Â· å‘è¡¨äº: 6å¤©å‰ Â· æœ€åå›å¤: 4å¤©å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 73<br>æµè§ˆ: 598
                        </div>
                    </li>
                </ul>
            </div>
        </div>

        <!-- çƒ­é—¨è¯é¢˜ -->
        <div class="forum-panel panel-level-3">
            <div class="panel-header">
                <h2 class="panel-title">çƒ­é—¨è¯é¢˜</h2>
                <a href="#" class="panel-more require-login">æ›´å¤š</a>
            </div>
            <div class="panel-body">
                <ul class="post-list">
                    <li class="post-item">
                        <div class="post-icon">ğŸŒŒ</div>
                        <div class="post-content">
                            <a href="#" class="post-title">å…³äºçœŸèŒ"çŠ¹æ ¼æ–¯"çš„ä¼ æ’­å‡è¯´</a>
                            <div class="post-meta">ä½œè€…: peaslee Â· å‘è¡¨äº: 3å¤©å‰ Â· æœ€åå›å¤: 2å°æ—¶å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 89<br>æµè§ˆ: 724
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸ“œ</div>
                        <div class="post-content">
                            <a href="#" class="post-title">ã€ç¿»è¯‘åä½œã€‘ã€Šç„å›ä¸ƒç« ç§˜ç»ã€‹æ®‹ç« </a>
                            <div class="post-meta">ä½œè€…: curwen Â· å‘è¡¨äº: 5å¤©å‰ Â· æœ€åå›å¤: 1å¤©å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 124<br>æµè§ˆ: 1103
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸ”®</div>
                        <div class="post-content">
                            <a href="#" class="post-title">ã€å¹²è´§ã€‘å¯†å¤§å›¾ä¹¦é¦†ç¦ä¹¦åŒºè®¿é—®æƒé™ç”³è¯·æµç¨‹è¯¦è§£</a>
                            <div class="post-meta">ä½œè€…: whateley Â· å‘è¡¨äº: 1å‘¨å‰ Â· æœ€åå›å¤: 3å¤©å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 156<br>æµè§ˆ: 1327
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸŒ™</div>
                        <div class="post-content">
                            <a href="#" class="post-title">æ–°æœˆä¹‹å¤œå¤©æ–‡è§‚æµ‹æ´»åŠ¨æŠ¥åå¼€å§‹</a>
                            <div class="post-meta">ä½œè€…: atwood Â· å‘è¡¨äº: 1å‘¨å‰ Â· æœ€åå›å¤: 2å¤©å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 97<br>æµè§ˆ: 845
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">ğŸ§¿</div>
                        <div class="post-content">
                            <a href="#" class="post-title">å…³äºå°æ–¯èŒ…æ–¯äº‹ä»¶çš„æ°‘é—´è®°å½•ä¸å®˜æ–¹æ¡£æ¡ˆå·®å¼‚</a>
                            <div class="post-meta">ä½œè€…: marsh Â· å‘è¡¨äº: 2å‘¨å‰ Â· æœ€åå›å¤: 4å¤©å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 203<br>æµè§ˆ: 1876
                        </div>
                    </li>
                    <li class="post-item">
                        <div class="post-icon">âš—ï¸</div>
                        <div class="post-content">
                            <a href="#" class="post-title">ç‚¼é‡‘æœ¯ä¸åˆç¡ç¤¾å›¢å…¬å¼€å®éªŒå±•ç¤º - è´¤è€…ä¹‹çŸ³çš„åˆ¶å¤‡</a>
                            <div class="post-meta">ä½œè€…: magnus Â· å‘è¡¨äº: 2å‘¨å‰ Â· æœ€åå›å¤: 5å¤©å‰</div>
                        </div>
                        <div class="post-stats">
                            å›å¤: 178<br>æµè§ˆ: 1623
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="footer">
        <p>æœ¬ç½‘ç«™çš„å†…å®¹ä¸ºè™šæ„æ¸¸æˆä½œå“ï¼Œä¸ä»»ä½•çœŸå®çš„äººç‰©ã€å›¢ä½“æˆ–äº‹ä»¶æ— å…³ã€‚</p>
        <p>CopyrightÂ© xukaiwen. All Rights Reserved.</p>
    </footer>
    
    <!-- ç™»å½•/æ³¨å†Œå¼¹çª— -->
    <div class="modal-overlay" id="login-modal">
        <div class="login-modal">
            <span class="close-modal" id="close-modal">&times;</span>
            <h2>ç™»å½•å­¦ç”Ÿè®ºå›</h2>
            <form>
                <div class="form-group">
                    <label for="username">ç”¨æˆ·å/é‚®ç®±</label>
                    <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·åæˆ–é‚®ç®±">
                </div>
                <div class="form-group">
                    <label for="password">å¯†ç </label>
                    <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç ">
                    <div class="error-message" id="login-error">è´¦å·é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥</div>
                </div>
                <div class="form-options">
                    <div class="remember-me">
                        <input type="checkbox" id="remember">
                        <label for="remember">è®°ä½æˆ‘</label>
                    </div>
                    <a href="#" class="forgot-password" id="forgot-password">å¿˜è®°å¯†ç ?</a>
                </div>
                <button type="button" class="login-btn" id="login-btn">ç™»å½•</button>
                <div class="register-link">
                    è¿˜æ²¡æœ‰è´¦å·? <a href="#" id="register-link">ç«‹å³æ³¨å†Œ</a>
                </div>
            </form>
        </div>
    </div>

    <!-- éª°å­æ’ä»¶å®¹å™¨ -->
    <div id="dicePluginContainer"></div>

    <script>
        // ç™»å½•å¼¹çª—æ§åˆ¶
        const loginLink = document.getElementById('login-link');
        const loginModal = document.getElementById('login-modal');
        const closeModal = document.getElementById('close-modal');
        const registerLink = document.getElementById('register-link');
        const forgotPasswordLink = document.getElementById('forgot-password');
        const loginBtn = document.getElementById('login-btn');
        const loginError = document.getElementById('login-error');
        
        loginLink.addEventListener('click', function(e) {
            e.preventDefault();
            loginModal.classList.add('active');
        });
        
        closeModal.addEventListener('click', function() {
            loginModal.classList.remove('active');
            loginError.style.display = 'none';
        });
        
        // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
        loginModal.addEventListener('click', function(e) {
            if (e.target === loginModal) {
                loginModal.classList.remove('active');
                loginError.style.display = 'none';
            }
        });
        
        // ä¸ºéœ€è¦ç™»å½•çš„å…ƒç´ æ·»åŠ äº‹ä»¶ç›‘å¬
        const requireLoginElements = document.querySelectorAll('.require-login');
        requireLoginElements.forEach(element => {
            element.addEventListener('click', function(e) {
                e.preventDefault();
                alert('è¯·å…ˆç™»å½•');
            });
        });
        
        // æ³¨å†Œé“¾æ¥ç‚¹å‡»äº‹ä»¶
        registerLink.addEventListener('click', function(e) {
            e.preventDefault();
            alert('è¯·ç™»å½•æ ¡å›­å±€åŸŸç½‘åæ³¨å†Œ');
        });
        
        // å¿˜è®°å¯†ç é“¾æ¥ç‚¹å‡»äº‹ä»¶
        forgotPasswordLink.addEventListener('click', function(e) {
            e.preventDefault();
            alert('è¯·è”ç³»ç®¡ç†å‘˜');
        });

        // æœç´¢æ¡†åŠŸèƒ½
        const searchInput = document.getElementById('search-input');
        const searchIcon = document.getElementById('search-icon');
        
        // æœç´¢å‡½æ•°
        function performSearch() {
            const searchTerm = searchInput.value.trim();
            if (searchTerm) {
                window.location.href = `search.html?q=${encodeURIComponent(searchTerm)}`;
            }
        }
        
        // è¾“å…¥æ¡†å›è½¦äº‹ä»¶
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        // æ”¾å¤§é•œå›¾æ ‡ç‚¹å‡»äº‹ä»¶
        searchIcon.addEventListener('click', function() {
            performSearch();
        });
        
        // å¸–å­ç‚¹å‡»äº‹ä»¶å¤„ç†
        const stickiedPost = document.getElementById('stickied-post');
        const allPostTitles = document.querySelectorAll('.post-title');
        
        // ä¸ºç½®é¡¶å¸–å­æ·»åŠ ç‚¹å‡»äº‹ä»¶
        stickiedPost.addEventListener('click', function(e) {
            e.preventDefault();
            window.location.href = 'xw1.html';
        });
        
        // ä¸ºå…¶ä»–æ‰€æœ‰å¸–å­æ·»åŠ ç‚¹å‡»äº‹ä»¶
        allPostTitles.forEach(postTitle => {
            // æ’é™¤ç½®é¡¶å¸–å­
            if (postTitle !== stickiedPost) {
                postTitle.addEventListener('click', function(e) {
                    e.preventDefault();
                    alert('ä½ ç¿»çœ‹äº†ä¸€ä¸‹ï¼Œè¿™äº›ä¿¡æ¯å¥½åƒè·Ÿå‡¯æ–‡æ²¡ä»€ä¹ˆå…³ç³»ã€‚');
                });
            }
        });
        
        // ç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        loginBtn.addEventListener('click', function(e) {
            e.preventDefault();
            // æ— è®ºè¾“å…¥ä»€ä¹ˆï¼Œéƒ½æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
            loginError.style.display = 'block';
        });
    </script>

    <!-- éª°å­æ’ä»¶è„šæœ¬ -->
    <script>
        // åƒç´ éª°å­æ’ä»¶ç±»
        class PixelDicePlugin {
            constructor(containerSelector, options = {}) {
                // é»˜è®¤é…ç½®
                this.config = {
                    userId: 'default_user',
                    userName: 'è°ƒæŸ¥å‘˜',
                    skillName: 'çµæ„Ÿ',
                    skillValue: 50,
                    extraText: '',
                    storageKey: 'pixelDiceState',
                    sanKey: 'pixelDiceSanState',
                    cooldownKey: 'pixelDiceCooldown',
                    ...options
                };
                
                // å®¹å™¨å…ƒç´ 
                this.container = document.querySelector(containerSelector);
                if (!this.container) {
                    console.error('æœªæ‰¾åˆ°å®¹å™¨å…ƒç´ :', containerSelector);
                    return;
                }
                
                // æ’ä»¶çŠ¶æ€ - åˆå§‹çŠ¶æ€è®¾ä¸ºæ¿€æ´»
                this.isActivated = true;
                this.isLoaded = false;
                this.isMinimized = true;
                this.currentPage = 1;
                
                // SANå€¼ç›¸å…³
                this.investigatorName = 'å¼ ä¸‰';
                this.sanValue = 100;
                this.maxSanValue = 100;
                
                // å†·å´ç›¸å…³
                this.cooldownDuration = 300;
                this.cooldownEndTime = null;
                this.cooldownTimer = null;
                
                // éšè—åŠŸèƒ½ç›¸å…³
                this.hiddenFeatureClickCount = 0;
                this.hiddenFeatureStartTime = 0;
                this.hiddenFeatureTimeout = null;
                
                // åˆå§‹åŒ–æ’ä»¶
                this.init();
            }
            
            // åˆå§‹åŒ–æ’ä»¶
            init() {
                // åŠ è½½ä¿å­˜çš„çŠ¶æ€
                this.loadState();
                
                // åˆ·æ–°localStorageæ•°æ®
                this.refreshLocalStorageData();
                
                // åˆ›å»ºæ’ä»¶UI
                this.createUI();
                
                // ç»‘å®šäº‹ä»¶
                this.bindEvents();
                
                // å¯åŠ¨å†·å´æ£€æŸ¥å®šæ—¶å™¨
                this.startCooldownTimer();
                
                this.isLoaded = true;
                console.log('åƒç´ éª°å­æ’ä»¶å·²åˆå§‹åŒ–');
            }
            
            // åˆ·æ–°localStorageæ•°æ®
            refreshLocalStorageData() {
                try {
                    // è®¾ç½®æŠ€èƒ½åç§°å’Œæ•°å€¼
                    this.config.skillName = 'çµæ„Ÿ';
                    this.config.skillValue = 50;
                    
                    // ä¿å­˜åˆ°localStorage
                    const state = {
                        isActivated: this.isActivated,
                        skillName: this.config.skillName,
                        skillValue: this.config.skillValue,
                        extraText: this.config.extraText,
                        savedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem(this.config.storageKey, JSON.stringify(state));
                    console.log('localStorageæ•°æ®å·²åˆ·æ–°ï¼šæŠ€èƒ½-çµæ„Ÿï¼Œæ•°å€¼-50');
                } catch (e) {
                    console.error('åˆ·æ–°localStorageæ•°æ®å¤±è´¥:', e);
                }
            }
            
            // åˆ›å»ºUI
            createUI() {
                // åˆ›å»ºæ’ä»¶å®¹å™¨
                this.pluginEl = document.createElement('div');
                this.pluginEl.className = 'pixel-dice-plugin';
                
                // åˆ›å»ºé¡µé¢å®¹å™¨
                const pagesContainer = document.createElement('div');
                pagesContainer.className = 'plugin-pages';
                
                // åˆ›å»ºé¡µé¢ä¸€ï¼ˆéª°å­é¡µé¢ï¼‰- å®Œå…¨ç‹¬ç«‹
                this.createDicePage(pagesContainer);
                
                // åˆ›å»ºé¡µé¢äºŒï¼ˆSANå€¼é¡µé¢ï¼‰- å®Œå…¨ç‹¬ç«‹
                this.createSanPage(pagesContainer);
                
                // åˆ›å»ºæ”¶ç¼©æŒ‰é’®
                this.createCollapseButton();
                
                // åˆ›å»ºå¯¼èˆªæŒ‰é’®ï¼ˆ> æŒ‰é’®ï¼‰
                this.createNextButton();
                
                // åˆ›å»ºè¿”å›æŒ‰é’®ï¼ˆ< æŒ‰é’®ï¼‰
                this.createPrevButton();
                
                // åˆ›å»ºç»“æœå¯¹è¯æ¡†
                this.createResultDialog();
                
                // åˆ›å»ºæœ€å°åŒ–å›¾æ ‡
                this.createMinimizedIcon();
                
                // ç»„è£…æ’ä»¶
                this.pluginEl.appendChild(pagesContainer);
                this.container.appendChild(this.pluginEl);
                
                // åˆå§‹çŠ¶æ€ä¸ºæœ€å°åŒ–ï¼Œæ˜¾ç¤ºåœ†å½¢å›¾æ ‡
                this.minimizedIcon.style.display = 'flex';
                
                // æ›´æ–°UIçŠ¶æ€
                this.updateUI();
            }
            
            // åˆ›å»ºéª°å­é¡µé¢ - å®Œå…¨ç‹¬ç«‹
            createDicePage(pagesContainer) {
                const dicePage = document.createElement('div');
                dicePage.className = 'plugin-page dice-page';
                
                // ç‰©å“æ˜¾ç¤ºåŒºåŸŸ
                const itemDisplay = document.createElement('div');
                itemDisplay.className = 'item-display';
                
                // ç‰©å“å›¾æ ‡
                this.itemIcon = document.createElement('div');
                this.itemIcon.className = 'dice-icon activated';
                this.itemIcon.title = 'å‘½è¿éª°å­ - å·²æ¿€æ´»';
                
                // ä½¿ç”¨å›¾ç‰‡ä½œä¸ºå›¾æ ‡
                const img = document.createElement('img');
                img.src = 'chajian/chajianimages/touzi.png';
                img.alt = 'éª°å­';
                img.className = 'dice-image';
                this.itemIcon.appendChild(img);
                
                // ç‰©å“åç§°
                const itemName = document.createElement('div');
                itemName.className = 'item-name';
                itemName.textContent = 'å‘½è¿éª°å­';
                
                // å†·å´ä¿¡æ¯æ˜¾ç¤º
                this.cooldownInfo = document.createElement('span');
                this.cooldownInfo.className = 'cooldown-info';
                
                itemName.appendChild(this.cooldownInfo);
                itemDisplay.appendChild(this.itemIcon);
                itemDisplay.appendChild(itemName);
                
                // æ–°å¢çš„æ­£æ–¹å½¢å›¾ç‰‡åŒºåŸŸ
                const diceImageContainer = document.createElement('div');
                diceImageContainer.className = 'dice-image-container';
                
                const diceMainImage = document.createElement('img');
                diceMainImage.src = 'chajian/touzi.png';
                diceMainImage.alt = 'éª°å­å›¾ç‰‡';
                diceMainImage.className = 'dice-main-image';
                diceImageContainer.appendChild(diceMainImage);
                
                // ä½¿ç”¨æŒ‰é’®
                this.useBtn = document.createElement('button');
                this.useBtn.className = 'use-btn';
                this.useBtn.textContent = 'ä½¿ç”¨';
                
                // å†·å´è¦†ç›–å±‚
                this.cooldownOverlay = document.createElement('div');
                this.cooldownOverlay.className = 'cooldown-overlay';
                this.cooldownOverlay.textContent = 'å†·å´ä¸­';
                this.useBtn.appendChild(this.cooldownOverlay);
                
                dicePage.appendChild(itemDisplay);
                dicePage.appendChild(diceImageContainer);
                dicePage.appendChild(this.useBtn);
                
                pagesContainer.appendChild(dicePage);
            }
            
            // åˆ›å»ºSANå€¼é¡µé¢ - å®Œå…¨ç‹¬ç«‹
            createSanPage(pagesContainer) {
                const sanPage = document.createElement('div');
                sanPage.className = 'plugin-page san-page';
                
                // é¡µé¢æ ‡é¢˜
                const pageTitle = document.createElement('div');
                pageTitle.className = 'page-title';
                pageTitle.textContent = 'è°ƒæŸ¥å‘˜çŠ¶æ€';
                sanPage.appendChild(pageTitle);
                
                // è°ƒæŸ¥å‘˜ä¿¡æ¯
                const investigatorInfo = document.createElement('div');
                investigatorInfo.className = 'investigator-info';
                
                // è°ƒæŸ¥å‘˜å§“å
                const nameGroup = document.createElement('div');
                nameGroup.className = 'info-group';
                
                const nameLabel = document.createElement('div');
                nameLabel.className = 'info-label';
                nameLabel.textContent = 'è°ƒæŸ¥å‘˜å§“å:';
                
                this.nameDisplay = document.createElement('div');
                this.nameDisplay.className = 'info-text';
                this.nameDisplay.textContent = this.investigatorName;
                
                nameGroup.appendChild(nameLabel);
                nameGroup.appendChild(this.nameDisplay);
                investigatorInfo.appendChild(nameGroup);
                
                // SANå€¼æ˜¾ç¤º
                const sanDisplay = document.createElement('div');
                sanDisplay.className = 'san-display';
                
                const sanLabel = document.createElement('div');
                sanLabel.className = 'san-label';
                sanLabel.innerHTML = '<span>SANå€¼</span><span class="san-value">' + this.sanValue + '/' + this.maxSanValue + '</span>';
                
                this.sanProgressContainer = document.createElement('div');
                this.sanProgressContainer.className = 'san-progress-container';
                
                this.sanProgressBar = document.createElement('div');
                this.sanProgressBar.className = 'san-progress-bar';
                this.sanProgressBar.style.width = (this.sanValue / this.maxSanValue) * 100 + '%';
                
                this.sanProgressText = document.createElement('div');
                this.sanProgressText.className = 'san-progress-text';
                this.sanProgressText.textContent = this.sanValue + '/' + this.maxSanValue;
                
                this.sanProgressContainer.appendChild(this.sanProgressBar);
                this.sanProgressContainer.appendChild(this.sanProgressText);
                
                sanDisplay.appendChild(sanLabel);
                sanDisplay.appendChild(this.sanProgressContainer);
                
                sanPage.appendChild(investigatorInfo);
                sanPage.appendChild(sanDisplay);
                
                pagesContainer.appendChild(sanPage);
            }
            
            // åˆ›å»ºæ”¶ç¼©æŒ‰é’®
            createCollapseButton() {
                this.collapseBtn = document.createElement('div');
                this.collapseBtn.className = 'nav-btn collapse-btn';
                this.collapseBtn.innerHTML = 'âˆ’';
                this.collapseBtn.title = 'æœ€å°åŒ–';
                this.pluginEl.appendChild(this.collapseBtn);
            }
            
            // åˆ›å»ºä¸‹ä¸€é¡µæŒ‰é’®
            createNextButton() {
                this.nextBtn = document.createElement('div');
                this.nextBtn.className = 'nav-btn next-btn';
                this.nextBtn.innerHTML = 'â€º';
                this.nextBtn.title = 'ä¸‹ä¸€é¡µ';
                this.pluginEl.appendChild(this.nextBtn);
            }
            
            // åˆ›å»ºä¸Šä¸€é¡µæŒ‰é’®
            createPrevButton() {
                this.prevBtn = document.createElement('div');
                this.prevBtn.className = 'nav-btn prev-btn';
                this.prevBtn.innerHTML = 'â€¹';
                this.prevBtn.title = 'ä¸Šä¸€é¡µ';
                this.pluginEl.appendChild(this.prevBtn);
            }
            
            // åˆ›å»ºç»“æœå¯¹è¯æ¡†
            createResultDialog() {
                // å¯¹è¯æ¡†é®ç½©
                this.dialogOverlay = document.createElement('div');
                this.dialogOverlay.className = 'dialog-overlay';
                
                // å¯¹è¯æ¡†å†…å®¹
                this.dialogContent = document.createElement('div');
                this.dialogContent.className = 'dialog-content';
                
                // å¯¹è¯æ¡†æ–‡æœ¬
                this.dialogText = document.createElement('div');
                this.dialogText.className = 'dialog-text';
                
                // å…³é—­æŒ‰é’®
                this.dialogClose = document.createElement('button');
                this.dialogClose.className = 'dialog-close';
                this.dialogClose.textContent = 'å…³é—­';
                
                this.dialogContent.appendChild(this.dialogText);
                this.dialogContent.appendChild(this.dialogClose);
                this.dialogOverlay.appendChild(this.dialogContent);
                
                // æ·»åŠ åˆ°body
                document.body.appendChild(this.dialogOverlay);
            }
            
            // åˆ›å»ºæœ€å°åŒ–å›¾æ ‡
            createMinimizedIcon() {
                this.minimizedIcon = document.createElement('div');
                this.minimizedIcon.className = 'dice-minimized';
                this.minimizedIcon.title = 'éª°å­æ’ä»¶ (ç‚¹å‡»å±•å¼€)';
                
                // åŠ å·å›¾æ ‡
                const expandIcon = document.createElement('div');
                expandIcon.className = 'expand-icon';
                expandIcon.innerHTML = '+';
                
                this.minimizedIcon.appendChild(expandIcon);
                
                // æ·»åŠ åˆ°body
                document.body.appendChild(this.minimizedIcon);
            }
            
            // ç»‘å®šäº‹ä»¶
            bindEvents() {
                // æ”¶ç¼©æŒ‰é’®ç‚¹å‡»
                this.collapseBtn.addEventListener('click', () => this.collapse());
                
                // ä¸‹ä¸€é¡µæŒ‰é’®ç‚¹å‡»
                this.nextBtn.addEventListener('click', () => this.nextPage());
                
                // ä¸Šä¸€é¡µæŒ‰é’®ç‚¹å‡»
                this.prevBtn.addEventListener('click', () => this.prevPage());
                
                // ä½¿ç”¨æŒ‰é’®ç‚¹å‡»
                this.useBtn.addEventListener('click', () => this.useDice());
                
                // ç‰©å“å›¾æ ‡æ‚¬åœæç¤º
                this.itemIcon.addEventListener('mouseenter', () => this.showTooltip());
                this.itemIcon.addEventListener('mouseleave', () => this.hideTooltip());
                
                // ç‰©å“å›¾æ ‡ç‚¹å‡» - éšè—åŠŸèƒ½ï¼ˆæ— UIæç¤ºï¼‰
                this.itemIcon.addEventListener('click', (e) => this.handleHiddenFeatureClick(e));
                
                // æœ€å°åŒ–å›¾æ ‡ç‚¹å‡»
                this.minimizedIcon.addEventListener('click', () => this.expand());
                
                // å…³é—­å¯¹è¯æ¡†
                this.dialogClose.addEventListener('click', () => this.closeDialog());
                this.dialogOverlay.addEventListener('click', (e) => {
                    if (e.target === this.dialogOverlay) {
                        this.closeDialog();
                    }
                });
                
                // ESCé”®å…³é—­å¯¹è¯æ¡†
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'Escape' && this.dialogOverlay.style.display === 'flex') {
                        this.closeDialog();
                    }
                });
            }
            
            // å¤„ç†éšè—åŠŸèƒ½ç‚¹å‡»ï¼ˆæ— UIåŠ¨ç”»ï¼‰
            handleHiddenFeatureClick(e) {
                e.stopPropagation();
                
                const now = Date.now();
                
                // å¦‚æœç¬¬ä¸€æ¬¡ç‚¹å‡»æˆ–è€…è¶…è¿‡4ç§’ï¼Œé‡ç½®è®¡æ•°å™¨
                if (now - this.hiddenFeatureStartTime > 4000) {
                    this.hiddenFeatureClickCount = 0;
                    this.hiddenFeatureStartTime = now;
                }
                
                // å¢åŠ ç‚¹å‡»è®¡æ•°
                this.hiddenFeatureClickCount++;
                
                // æ¸…é™¤ä¹‹å‰çš„è¶…æ—¶
                if (this.hiddenFeatureTimeout) {
                    clearTimeout(this.hiddenFeatureTimeout);
                }
                
                // è®¾ç½®æ–°çš„è¶…æ—¶ï¼Œ4ç§’åé‡ç½®è®¡æ•°å™¨
                this.hiddenFeatureTimeout = setTimeout(() => {
                    this.hiddenFeatureClickCount = 0;
                }, 4000);
                
                // å¦‚æœè¾¾åˆ°10æ¬¡ç‚¹å‡»
                if (this.hiddenFeatureClickCount >= 10) {
                    this.activateHiddenFeature();
                    this.hiddenFeatureClickCount = 0;
                }
            }
            
            // æ¿€æ´»éšè—åŠŸèƒ½ï¼ˆé™é»˜å®Œæˆï¼Œæ— UIæç¤ºï¼‰
            activateHiddenFeature() {
                // ç«‹å³å®Œæˆå†·å´
                this.cooldownEndTime = null;
                this.saveCooldownState();
                this.updateCooldownDisplay();
                
                // æ¸…é™¤è¶…æ—¶
                if (this.hiddenFeatureTimeout) {
                    clearTimeout(this.hiddenFeatureTimeout);
                    this.hiddenFeatureTimeout = null;
                }
                
                // é‡ç½®è®¡æ•°å™¨
                this.hiddenFeatureClickCount = 0;
                
                // ä»…åœ¨æ§åˆ¶å°è¾“å‡ºä¿¡æ¯ï¼ˆç”¨äºè°ƒè¯•ï¼Œç”¨æˆ·çœ‹ä¸åˆ°ï¼‰
                console.log('éšè—åŠŸèƒ½æ¿€æ´»ï¼šå†·å´ç«‹å³å®Œæˆï¼');
            }
            
            // åˆ‡æ¢åˆ°ä¸‹ä¸€é¡µ
            nextPage() {
                if (this.currentPage === 1) {
                    this.currentPage = 2;
                    this.pluginEl.classList.add('page-switched');
                    this.updateNavButtons();
                }
            }
            
            // åˆ‡æ¢åˆ°ä¸Šä¸€é¡µ
            prevPage() {
                if (this.currentPage === 2) {
                    this.currentPage = 1;
                    this.pluginEl.classList.remove('page-switched');
                    this.updateNavButtons();
                }
            }
            
            // æ›´æ–°å¯¼èˆªæŒ‰é’®æ˜¾ç¤ºçŠ¶æ€
            updateNavButtons() {
                if (this.currentPage === 1) {
                    // é¡µé¢ä¸€ï¼šæ˜¾ç¤º>æŒ‰é’®ï¼Œéšè—<æŒ‰é’®
                    this.nextBtn.style.display = 'flex';
                    this.prevBtn.style.display = 'none';
                } else if (this.currentPage === 2) {
                    // é¡µé¢äºŒï¼šæ˜¾ç¤º<æŒ‰é’®ï¼Œéšè—>æŒ‰é’®
                    this.prevBtn.style.display = 'flex';
                    this.nextBtn.style.display = 'none';
                }
            }
            
            // æ”¶ç¼©æ’ä»¶
            collapse() {
                this.isMinimized = true;
                this.pluginEl.style.display = 'none';
                this.minimizedIcon.style.display = 'flex';
            }
            
            // å±•å¼€æ’ä»¶
            expand() {
                this.isMinimized = false;
                this.pluginEl.style.display = 'block';
                this.minimizedIcon.style.display = 'none';
            }
            
            // æ¿€æ´»éª°å­
            activateDice() {
                if (this.isActivated) return;
                
                this.isActivated = true;
                this.updateUI();
                this.saveState();
                
                // æ˜¾ç¤ºæ¿€æ´»åé¦ˆ
                this.itemIcon.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    this.itemIcon.style.transform = 'scale(1)';
                }, 300);
                
                console.log('éª°å­ç‰©å“å·²æ¿€æ´»');
            }
            
            // å…³é—­éª°å­ï¼ˆä¾›å¤–éƒ¨è°ƒç”¨ï¼‰
            deactivateDice() {
                if (!this.isActivated) return;
                
                this.isActivated = false;
                this.updateUI();
                this.saveState();
                
                console.log('éª°å­ç‰©å“å·²å…³é—­');
            }
            
            // æ›´æ–°SANå€¼æ˜¾ç¤º
            updateSanDisplay() {
                if (this.sanProgressBar && this.sanProgressText) {
                    const percentage = (this.sanValue / this.maxSanValue) * 100;
                    this.sanProgressBar.style.width = percentage + '%';
                    this.sanProgressText.textContent = this.sanValue + '/' + this.maxSanValue;
                    
                    // æ›´æ–°SANå€¼æ ‡ç­¾
                    const sanLabel = this.sanProgressContainer.parentElement.querySelector('.san-label');
                    if (sanLabel) {
                        sanLabel.querySelector('.san-value').textContent = this.sanValue + '/' + this.maxSanValue;
                    }
                }
            }
            
            // è®¾ç½®SANå€¼
            setSanValue(value) {
                const newValue = Math.max(0, Math.min(this.maxSanValue, parseInt(value) || 0));
                if (this.sanValue !== newValue) {
                    this.sanValue = newValue;
                    this.updateSanDisplay();
                    this.saveSanState();
                    return true;
                }
                return false;
            }
            
            // ä½¿ç”¨éª°å­
            useDice() {
                // æ£€æŸ¥å†·å´çŠ¶æ€
                if (this.isInCooldown()) {
                    const remaining = this.getCooldownRemaining();
                    alert(`éª°å­æ­£åœ¨å†·å´ä¸­ï¼Œè¯·ç­‰å¾…${Math.ceil(remaining / 60)}åˆ†é’Ÿ${remaining % 60}ç§’åå†ä½¿ç”¨`);
                    return;
                }
                
                if (!this.isActivated) {
                    alert('è¯·å…ˆæ¿€æ´»éª°å­ç‰©å“');
                    return;
                }
                
                // è·å–é…ç½®å€¼ï¼Œä¼˜å…ˆä½¿ç”¨è°ƒæŸ¥å‘˜å§“å
                const userName = this.investigatorName || this.config.userName;
                const skillName = this.config.skillName || 'çµæ„Ÿ';
                const skillValue = this.config.skillValue || 50;
                const extraText = this.config.extraText || '';
                
                // éªŒè¯æŠ€èƒ½å€¼
                if (skillValue < 0 || skillValue > 100) {
                    alert('æŠ€èƒ½æ•°å€¼å¿…é¡»åœ¨0-100ä¹‹é—´');
                    return;
                }
                
                // æ‰§è¡Œæ£€å®š
                const result = this.performD100Check({
                    userName,
                    skillName,
                    skillValue,
                    extraText
                });
                
                // æ˜¾ç¤ºç»“æœ
                this.showResult(result);
                
                // æ ¹æ®æˆåŠŸç­‰çº§è®¾ç½®å†·å´æ—¶é—´
                if (result.successLevel === 'critical_failure') {
                    // å¤§å¤±è´¥ï¼šå†·å´æ—¶é—´10åˆ†é’Ÿ
                    this.startCooldown(600);
                    console.log('å¤§å¤±è´¥ï¼Œå†·å´æ—¶é—´è®¾ç½®ä¸º10åˆ†é’Ÿ');
                } else {
                    // å…¶ä»–æƒ…å†µï¼šé»˜è®¤å†·å´æ—¶é—´5åˆ†é’Ÿ
                    this.startCooldown();
                }
            }
            
            // D100æ£€å®šé€»è¾‘
            performD100Check(params) {
                // ç”Ÿæˆä¸¤ä¸ªD10éšæœºæ•°ï¼ˆä¸ªä½å’Œåä½ï¼‰
                const rollD10 = () => Math.floor(Math.random() * 10) + 1;
                const tens = rollD10() - 1;
                const units = rollD10() - 1;
                
                // è®¡ç®—æ€»å€¼ï¼ˆä¸¤ä¸ª0è¡¨ç¤º100ï¼‰
                let total;
                if (tens === 0 && units === 0) {
                    total = 100;
                } else {
                    total = tens * 10 + units;
                }
                
                // è®¡ç®—æˆåŠŸç­‰çº§
                const successInfo = this.calculateSuccessLevel(total, params.skillValue);
                
                // è·å–æˆåŠŸç­‰çº§å¯¹åº”çš„é™„åŠ æ–‡æœ¬
                const successLevelExtraText = this.getSuccessLevelExtraText(successInfo.successLevel);
                
                // æ„å»ºç»“æœæ–‡æœ¬
                let resultText = `${params.userName}çš„"${params.skillName}"æ£€å®šç»“æœä¸ºD100=${total}/${params.skillValue},${successInfo.successLevelText}`;
                
                // æ·»åŠ æˆåŠŸç­‰çº§é™„åŠ æ–‡æœ¬
                resultText += `\n${successLevelExtraText}`;
                
                // æ·»åŠ ç”¨æˆ·æä¾›çš„é™„åŠ æ–‡æœ¬ï¼ˆå¦‚æœæœ‰ï¼‰
                if (params.extraText && params.extraText.trim() !== '') {
                    resultText += `\n\n${params.extraText}`;
                }
                
                // è¿”å›ç»“æœ
                return {
                    userName: params.userName,
                    skillName: params.skillName,
                    skillValue: params.skillValue,
                    rollValue: total,
                    tens,
                    units,
                    successLevel: successInfo.successLevel,
                    successLevelText: successInfo.successLevelText,
                    resultText,
                    extraText: params.extraText,
                    timestamp: new Date().toISOString()
                };
            }
            
            // è·å–æˆåŠŸç­‰çº§å¯¹åº”çš„é™„åŠ æ–‡æœ¬ï¼ˆæ ¹æ®è¦æ±‚ä¿®æ”¹ï¼‰
            getSuccessLevelExtraText(successLevel) {
                // æˆåŠŸç­‰çº§å¯¹åº”çš„æ–‡æœ¬
                const successLevelTexts = {
                    'critical_success': 'ä½ æ€è€ƒäº†ä¸€ä¼šï¼Œæƒ³åˆ°æˆ–è®¸å¯ä»¥æœæœé‚£ä¸ªå‡¯æ–‡è¦å»çš„æ³—æ°´é•‡ã€‚è‡³äºç™»å½•ï¼Œä½ åˆä¸æ˜¯è¿™ä¸ªå­¦æ ¡çš„å­¦ç”Ÿ',
                    'extreme_success': 'ä½ æ€è€ƒäº†ä¸€ä¼šï¼Œæƒ³åˆ°æˆ–è®¸å¯ä»¥æœæœé‚£ä¸ªå‡¯æ–‡è¦å»çš„æ³—æ°´é•‡ã€‚',
                    'hard_success': 'ä½ æ€è€ƒäº†ä¸€ä¼šï¼Œæƒ³åˆ°æˆ–è®¸å¯ä»¥æœæœé‚£ä¸ªå‡¯æ–‡è¦å»çš„æ³—æ°´é•‡ã€‚',
                    'regular_success': 'ä½ æ€è€ƒäº†ä¸€ä¼šï¼Œæƒ³åˆ°æˆ–è®¸å¯ä»¥æœæœé‚£ä¸ªå‡¯æ–‡è¦å»çš„æ³—æ°´é•‡ã€‚',
                    'failure': 'å­¦ç”Ÿè®ºå›ä¸­çš„ä¿¡æ¯å¤ªå¤šå¤ªæ‚ï¼Œä½ æš‚æ—¶æƒ³ä¸åˆ°èƒ½åšä»€ä¹ˆã€‚',
                    'critical_failure': 'å­¦ç”Ÿè®ºå›ä¸­çš„ä¿¡æ¯å¤ªå¤šå¤ªæ‚ï¼Œä½ æ²‰æµ¸åœ¨å…¶ä¸­æ— æ³•è‡ªæ‹”ï¼Œéª°å­å†·å´æ—¶é—´åŠ é•¿ã€‚'
                };
                
                return successLevelTexts[successLevel] || 'æœªçŸ¥çš„æˆåŠŸç­‰çº§';
            }
            
            // è·å–æˆåŠŸç­‰çº§å¯¹åº”çš„CSSç±»å
            getSuccessLevelClassName(successLevel) {
                const classMap = {
                    'critical_success': 'critical-success-text',
                    'extreme_success': 'extreme-success-text',
                    'hard_success': 'hard-success-text',
                    'regular_success': 'regular-success-text',
                    'failure': 'failure-text',
                    'critical_failure': 'critical-failure-text'
                };
                return classMap[successLevel] || 'regular-success-text';
            }
            
            // è®¡ç®—æˆåŠŸç­‰çº§
            calculateSuccessLevel(rollValue, skillValue) {
                // å‘ä¸‹å–æ•´
                const floor = (num) => Math.floor(num);
                const halfSkill = floor(skillValue / 2);
                const fifthSkill = floor(skillValue / 5);
                
                let successLevel;
                let successLevelText;
                
                // å¤§æˆåŠŸï¼šå°äºç­‰äº5
                if (rollValue <= 5) {
                    successLevel = 'critical_success';
                    successLevelText = 'å¤§æˆåŠŸ';
                }
                // å¤§å¤±è´¥ï¼šå¤§äºç­‰äº96
                else if (rollValue >= 96) {
                    successLevel = 'critical_failure';
                    successLevelText = 'å¤§å¤±è´¥';
                }
                // æéš¾æˆåŠŸï¼šå°äºç­‰äºæŠ€èƒ½å€¼çš„1/5ä¸”å¤§äº5
                else if (rollValue <= fifthSkill && rollValue > 5) {
                    successLevel = 'extreme_success';
                    successLevelText = 'æéš¾æˆåŠŸ';
                }
                // å›°éš¾æˆåŠŸï¼šå°äºç­‰äºæŠ€èƒ½å€¼çš„ä¸€åŠä¸”å¤§äºæŠ€èƒ½å€¼çš„1/5
                else if (rollValue <= halfSkill && rollValue > fifthSkill) {
                    successLevel = 'hard_success';
                    successLevelText = 'å›°éš¾æˆåŠŸ';
                }
                // æ™®é€šæˆåŠŸï¼šå°äºç­‰äºæŠ€èƒ½å€¼ä¸”å¤§äºæŠ€èƒ½å€¼çš„ä¸€åŠ
                else if (rollValue <= skillValue && rollValue > halfSkill) {
                    successLevel = 'regular_success';
                    successLevelText = 'æ™®é€šæˆåŠŸ';
                }
                // å¤±è´¥ï¼šå¤§äºæŠ€èƒ½å€¼ä¸”å°äº96
                else {
                    successLevel = 'failure';
                    successLevelText = 'å¤±è´¥';
                }
                
                return {
                    successLevel,
                    successLevelText,
                    halfSkill,
                    fifthSkill
                };
            }
            
            // æ˜¾ç¤ºæ£€å®šç»“æœ
            showResult(result) {
                // æ˜¾ç¤ºå¯¹è¯æ¡†
                this.dialogOverlay.style.display = 'flex';
                
                // æ¸…ç©ºæ–‡æœ¬
                this.dialogText.innerHTML = '';
                
                // è·å–æˆåŠŸç­‰çº§å¯¹åº”çš„CSSç±»å
                const successClass = this.getSuccessLevelClassName(result.successLevel);
                
                // æ„å»ºå¸¦æ ¼å¼çš„ç»“æœæ–‡æœ¬
                let formattedText = '';
                const lines = result.resultText.split('\n');
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i];
                    
                    // ç¬¬ä¸€è¡Œæ˜¯æ£€å®šç»“æœï¼Œä½¿ç”¨ä¸åŒé¢œè‰²
                    if (i === 0) {
                        formattedText += `<span class="${successClass}">${line}</span>`;
                    }
                    // ç¬¬äºŒè¡Œæ˜¯æˆåŠŸç­‰çº§é™„åŠ æ–‡æœ¬
                    else if (i === 1) {
                        formattedText += `<span class="${successClass}">${line}</span>`;
                    }
                    // ç¬¬ä¸‰è¡Œæ˜¯ç©ºè¡Œï¼ˆå¦‚æœæœ‰ç”¨æˆ·é™„åŠ æ–‡æœ¬ï¼‰
                    else if (i === 2 && line === '') {
                        formattedText += '<br>';
                    }
                    // ç”¨æˆ·æä¾›çš„é™„åŠ æ–‡æœ¬ï¼ˆå¦‚æœæœ‰ï¼‰
                    else if (i >= 2 && line.trim() !== '') {
                        formattedText += line;
                    }
                    
                    if (i < lines.length - 1 && lines[i+1] !== '') {
                        formattedText += '<br>';
                    }
                }
                
                // ä½¿ç”¨æ‰“å­—æœºæ•ˆæœæ˜¾ç¤ºç»“æœ
                this.typeWriter(formattedText, this.dialogText, 30, true);
            }
            
            // æ‰“å­—æœºæ•ˆæœï¼ˆæ”¯æŒHTMLï¼‰
            typeWriter(html, element, speed = 50, isHtml = false) {
                let i = 0;
                let fullText = '';
                
                // æå–HTMLä¸­çš„æ‰€æœ‰æ–‡æœ¬å†…å®¹
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                const textContent = tempDiv.textContent;
                
                function type() {
                    if (i < textContent.length) {
                        // è·å–å½“å‰ä½ç½®çš„å­—ç¬¦
                        const char = textContent.charAt(i);
                        
                        // æ„å»ºåˆ°å½“å‰ä½ç½®çš„æ–‡æœ¬
                        const currentText = textContent.substring(0, i + 1);
                        
                        // é‡å»ºHTMLç»“æ„ï¼Œä¿æŒæ ¼å¼
                        let newHtml = '';
                        let htmlIndex = 0;
                        let inTag = false;
                        let currentTag = '';
                        
                        for (let j = 0; j < html.length; j++) {
                            if (html[j] === '<') {
                                inTag = true;
                                currentTag = '<';
                            } else if (html[j] === '>') {
                                currentTag += '>';
                                newHtml += currentTag;
                                inTag = false;
                                currentTag = '';
                            } else if (inTag) {
                                currentTag += html[j];
                            } else {
                                // å¦‚æœæ˜¯æ–‡æœ¬å†…å®¹
                                if (htmlIndex < currentText.length) {
                                    newHtml += currentText.charAt(htmlIndex);
                                    htmlIndex++;
                                }
                            }
                        }
                        
                        element.innerHTML = newHtml;
                        
                        // æ·»åŠ é—ªçƒå…‰æ ‡
                        const cursor = document.createElement('span');
                        cursor.className = 'cursor';
                        element.appendChild(cursor);
                        
                        i++;
                        setTimeout(type, speed);
                    }
                }
                
                type();
            }
            
            // å…³é—­å¯¹è¯æ¡†
            closeDialog() {
                this.dialogOverlay.style.display = 'none';
                this.dialogText.innerHTML = '';
            }
            
            // æ˜¾ç¤ºå·¥å…·æç¤º
            showTooltip() {
                // åˆ›å»ºå·¥å…·æç¤ºå…ƒç´ 
                this.tooltip = document.createElement('div');
                this.tooltip.className = 'dice-tooltip';
                
                // è·å–ç‰©å“ä¿¡æ¯
                const itemInfo = {
                    tooltip: `
                        <div style="margin-bottom: 8px;"><strong>å‘½è¿éª°å­</strong></div>
                        <div style="margin-bottom: 8px;">ç¥ç§˜çš„éª°å­ï¼Œè¢«ä¸–ç•Œä¹‹å¤–çš„é«˜ç»´å™äº‹åŠ›é‡æ‰€æŒæ§ã€‚</div>
                        <div style="margin-bottom: 8px;">å¯ä»¥è¿›è¡ŒD100æ£€å®šï¼Œæ˜¯è°ƒæŸ¥å‘˜äººç”Ÿç»å†ï¼ŒæŠ€èƒ½å’Œç›®å‰çŠ¶çš„ç»¼åˆä½“ç°ã€‚</div>
                        <div style="margin-bottom: 8px; height: 8px;"></div> <!-- ç©ºè¡Œ -->
                        <div class="warning-text" style="margin-bottom: 8px;">"å½“ä½ æƒ³ä½¿ç”¨å®ƒæ“çºµè§’è‰²çš„äººç”Ÿæ—¶ï¼Œè¯·ç•™æ„æš—å¤„æ“çºµéª°å­çš„å¯èƒ½å¹¶éåªæœ‰ä½ ä¸€ä¸ªäººã€‚è‹¥éå¿…è¦è¯·ä¸è¦ä½¿ç”¨å®ƒ"</div>
                        <div style="margin-bottom: 8px; height: 8px;"></div> <!-- ç©ºè¡Œ -->
                        <div style="margin-bottom: 4px;">ç¨€æœ‰åº¦: <span class="epic-text">å²è¯—</span></div>
                        <div>å†·å´æ—¶é—´: 5åˆ†é’Ÿ</div>
                        <div>ä½¿ç”¨æ–¹å¼: å•å‡»è¿›è¡Œæ£€å®šã€‚</div>
                    `
                };
                
                // è®¾ç½®å·¥å…·æç¤ºå†…å®¹
                this.tooltip.innerHTML = itemInfo.tooltip;
                
                // æ·»åŠ åˆ°bodyä»¥ä¾¿è®¡ç®—å°ºå¯¸
                document.body.appendChild(this.tooltip);
                
                // è·å–å›¾æ ‡å’Œå·¥å…·æç¤ºçš„ä½ç½®å’Œå°ºå¯¸
                const rect = this.itemIcon.getBoundingClientRect();
                const tooltipWidth = this.tooltip.offsetWidth;
                const tooltipHeight = this.tooltip.offsetHeight;
                
                // è®¡ç®—ä½ç½®ï¼šå·¥å…·æç¤ºçš„å³ä¸‹è§’å¯¹é½å›¾æ ‡çš„å·¦ä¸Šè§’
                let left = rect.left - tooltipWidth;
                let top = rect.top - tooltipHeight;
                
                // å¦‚æœå·¦è¾¹ç•Œè¶…å‡ºå±å¹•ï¼Œåˆ™è°ƒæ•´åˆ°å›¾æ ‡å³ä¾§
                if (left < 10) {
                    left = rect.right + 10;
                }
                
                // å¦‚æœä¸Šè¾¹ç•Œè¶…å‡ºå±å¹•ï¼Œåˆ™è°ƒæ•´åˆ°åº•éƒ¨
                if (top < 10) {
                    top = rect.bottom + 10;
                }
                
                // è®¾ç½®å·¥å…·æç¤ºä½ç½®
                this.tooltip.style.position = 'fixed';
                this.tooltip.style.left = left + 'px';
                this.tooltip.style.top = top + 'px';
            }
            
            // éšè—å·¥å…·æç¤º
            hideTooltip() {
                if (this.tooltip && this.tooltip.parentNode) {
                    this.tooltip.parentNode.removeChild(this.tooltip);
                    this.tooltip = null;
                }
            }
            
            // æ›´æ–°UIçŠ¶æ€
            updateUI() {
                if (!this.isLoaded) return;
                
                // æ›´æ–°æ¿€æ´»çŠ¶æ€
                if (this.isActivated) {
                    this.itemIcon.classList.add('activated');
                    this.itemIcon.title = 'å‘½è¿éª°å­ - å·²æ¿€æ´»';
                } else {
                    this.itemIcon.classList.remove('activated');
                    this.itemIcon.title = 'å‘½è¿éª°å­ - æœªæ¿€æ´»';
                }
                
                // æ›´æ–°å¯¼èˆªæŒ‰é’®
                this.updateNavButtons();
            }
            
            // åŠ è½½ä¿å­˜çš„çŠ¶æ€
            loadState() {
                // åŠ è½½éª°å­çŠ¶æ€
                try {
                    const savedState = localStorage.getItem(this.config.storageKey);
                    if (savedState) {
                        const state = JSON.parse(savedState);
                        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½æ¿€æ´»çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¿æŒé»˜è®¤æ¿€æ´»çŠ¶æ€
                        this.isActivated = state.isActivated !== undefined ? state.isActivated : true;
                        this.config.skillName = state.skillName || 'çµæ„Ÿ';
                        this.config.skillValue = state.skillValue || 50;
                        this.config.extraText = state.extraText || '';
                        console.log('æ’ä»¶çŠ¶æ€å·²åŠ è½½');
                    }
                } catch (e) {
                    console.error('åŠ è½½æ’ä»¶çŠ¶æ€å¤±è´¥:', e);
                }
                
                // åŠ è½½SANå€¼çŠ¶æ€
                try {
                    const savedSanState = localStorage.getItem(this.config.sanKey);
                    if (savedSanState) {
                        const sanState = JSON.parse(savedSanState);
                        this.investigatorName = sanState.investigatorName || 'å¼ ä¸‰';
                        this.sanValue = sanState.sanValue !== undefined ? sanState.sanValue : 100;
                        console.log('SANå€¼çŠ¶æ€å·²åŠ è½½');
                    }
                } catch (e) {
                    console.error('åŠ è½½SANå€¼çŠ¶æ€å¤±è´¥:', e);
                }
                
                // åŠ è½½å†·å´çŠ¶æ€
                this.loadCooldownState();
                
                // æ›´æ–°SANå€¼æ˜¾ç¤º
                this.updateSanDisplay();
                
                // æ›´æ–°å†·å´æ˜¾ç¤º
                this.updateCooldownDisplay();
            }
            
            // ä¿å­˜éª°å­çŠ¶æ€
            saveState() {
                try {
                    const state = {
                        isActivated: this.isActivated,
                        skillName: this.config.skillName,
                        skillValue: this.config.skillValue,
                        extraText: this.config.extraText,
                        savedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem(this.config.storageKey, JSON.stringify(state));
                } catch (e) {
                    console.error('ä¿å­˜æ’ä»¶çŠ¶æ€å¤±è´¥:', e);
                }
            }
            
            // ä¿å­˜SANå€¼çŠ¶æ€
            saveSanState() {
                try {
                    const sanState = {
                        investigatorName: this.investigatorName,
                        sanValue: this.sanValue,
                        maxSanValue: this.maxSanValue,
                        savedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem(this.config.sanKey, JSON.stringify(sanState));
                } catch (e) {
                    console.error('ä¿å­˜SANå€¼çŠ¶æ€å¤±è´¥:', e);
                }
            }
            
            // å†·å´ç›¸å…³æ–¹æ³•
            
            // åŠ è½½å†·å´çŠ¶æ€
            loadCooldownState() {
                try {
                    const savedCooldown = localStorage.getItem(this.config.cooldownKey);
                    if (savedCooldown) {
                        const cooldownData = JSON.parse(savedCooldown);
                        this.cooldownEndTime = cooldownData.endTime;
                        console.log('å†·å´çŠ¶æ€å·²åŠ è½½');
                    }
                } catch (e) {
                    console.error('åŠ è½½å†·å´çŠ¶æ€å¤±è´¥:', e);
                }
            }
            
            // ä¿å­˜å†·å´çŠ¶æ€
            saveCooldownState() {
                try {
                    const cooldownData = {
                        endTime: this.cooldownEndTime,
                        savedAt: new Date().toISOString()
                    };
                    
                    localStorage.setItem(this.config.cooldownKey, JSON.stringify(cooldownData));
                } catch (e) {
                    console.error('ä¿å­˜å†·å´çŠ¶æ€å¤±è´¥:', e);
                }
            }
            
            // å¼€å§‹å†·å´
            startCooldown(duration = this.cooldownDuration) {
                // è®¾ç½®å†·å´ç»“æŸæ—¶é—´ï¼ˆå½“å‰æ—¶é—´ + æŒ‡å®šæ—¶é•¿ï¼‰
                this.cooldownEndTime = Date.now() + (duration * 1000);
                
                // ä¿å­˜å†·å´çŠ¶æ€
                this.saveCooldownState();
                
                // æ›´æ–°å†·å´æ˜¾ç¤º
                this.updateCooldownDisplay();
                
                console.log(`éª°å­å†·å´å¼€å§‹ï¼ŒæŒç»­${duration/60}åˆ†é’Ÿ`);
            }
            
            // æ£€æŸ¥æ˜¯å¦åœ¨å†·å´ä¸­
            isInCooldown() {
                if (!this.cooldownEndTime) return false;
                
                const now = Date.now();
                return now < this.cooldownEndTime;
            }
            
            // è·å–å‰©ä½™å†·å´æ—¶é—´ï¼ˆç§’ï¼‰
            getCooldownRemaining() {
                if (!this.isInCooldown()) return 0;
                
                const now = Date.now();
                const remainingMs = this.cooldownEndTime - now;
                return Math.max(0, Math.ceil(remainingMs / 1000));
            }
            
            // æ ¼å¼åŒ–å‰©ä½™æ—¶é—´
            formatCooldownTime(seconds) {
                const minutes = Math.floor(seconds / 60);
                const remainingSeconds = seconds % 60;
                return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
            }
            
            // æ›´æ–°å†·å´æ˜¾ç¤º
            updateCooldownDisplay() {
                if (!this.isLoaded) return;
                
                const inCooldown = this.isInCooldown();
                
                // æ›´æ–°æŒ‰é’®çŠ¶æ€
                this.useBtn.disabled = inCooldown;
                
                // æ›´æ–°å†·å´è¦†ç›–å±‚æ˜¾ç¤º
                if (inCooldown) {
                    const remaining = this.getCooldownRemaining();
                    this.cooldownOverlay.textContent = `å†·å´ä¸­ (${this.formatCooldownTime(remaining)})`;
                    this.cooldownOverlay.style.display = 'flex';
                    
                    // æ›´æ–°ç‰©å“å›¾æ ‡çŠ¶æ€
                    this.itemIcon.classList.add('cooldown');
                    this.itemIcon.classList.remove('activated');
                    
                    // æ›´æ–°å†·å´ä¿¡æ¯æ˜¾ç¤º
                    this.cooldownInfo.textContent = `å†·å´ä¸­ (${this.formatCooldownTime(remaining)})`;
                } else {
                    this.cooldownOverlay.style.display = 'none';
                    
                    // æ¢å¤ç‰©å“å›¾æ ‡çŠ¶æ€
                    this.itemIcon.classList.remove('cooldown');
                    if (this.isActivated) {
                        this.itemIcon.classList.add('activated');
                    }
                    
                    // æ¸…é™¤å†·å´ä¿¡æ¯æ˜¾ç¤º
                    this.cooldownInfo.textContent = '';
                }
            }
            
            // å¯åŠ¨å†·å´è®¡æ—¶å™¨
            startCooldownTimer() {
                // æ¸…é™¤ç°æœ‰çš„è®¡æ—¶å™¨
                if (this.cooldownTimer) {
                    clearInterval(this.cooldownTimer);
                }
                
                // æ¯ç§’æ›´æ–°ä¸€æ¬¡å†·å´æ˜¾ç¤º
                this.cooldownTimer = setInterval(() => {
                    this.updateCooldownDisplay();
                }, 1000);
            }
            
            // å…¬å…±APIæ–¹æ³•
            
            // è®¾ç½®ç”¨æˆ·å
            setUserName(name) {
                this.config.userName = name || 'è°ƒæŸ¥å‘˜';
                return this;
            }
            
            // è®¾ç½®è°ƒæŸ¥å‘˜å§“å
            setInvestigatorName(name) {
                this.investigatorName = name || 'å¼ ä¸‰';
                if (this.nameDisplay) {
                    this.nameDisplay.textContent = this.investigatorName;
                }
                this.saveSanState();
                return this;
            }
            
            // è®¾ç½®æŠ€èƒ½åç§°
            setSkillName(name) {
                this.config.skillName = name || 'çµæ„Ÿ';
                this.saveState();
                return this;
            }
            
            // è®¾ç½®æŠ€èƒ½æ•°å€¼
            setSkillValue(value) {
                this.config.skillValue = parseInt(value) || 50;
                this.saveState();
                return this;
            }
            
            // è®¾ç½®é™„åŠ æ–‡æœ¬
            setExtraText(text) {
                this.config.extraText = text || '';
                this.saveState();
                return this;
            }
            
            // è®¾ç½®SANå€¼
            setSan(value) {
                this.setSanValue(value);
                return this;
            }
            
            // æ‰‹åŠ¨æ¿€æ´»éª°å­
            activate() {
                this.activateDice();
                return this;
            }
            
            // æ‰‹åŠ¨å…³é—­éª°å­
            deactivate() {
                this.deactivateDice();
                return this;
            }
            
            // æ‰§è¡Œæ£€å®š
            roll(skillName, skillValue, extraText) {
                if (skillName) this.setSkillName(skillName);
                if (skillValue) this.setSkillValue(skillValue);
                if (extraText) this.setExtraText(extraText);
                
                this.useDice();
                return this;
            }
            
            // æ¸…é™¤å†·å´
            clearCooldown() {
                this.cooldownEndTime = null;
                localStorage.removeItem(this.config.cooldownKey);
                this.updateCooldownDisplay();
                console.log('å†·å´å·²æ¸…é™¤');
                return this;
            }
            
            // é”€æ¯æ’ä»¶
            destroy() {
                // æ¸…é™¤å†·å´è®¡æ—¶å™¨
                if (this.cooldownTimer) {
                    clearInterval(this.cooldownTimer);
                }
                
                // æ¸…é™¤éšè—åŠŸèƒ½è¶…æ—¶
                if (this.hiddenFeatureTimeout) {
                    clearTimeout(this.hiddenFeatureTimeout);
                }
                
                // ç§»é™¤äº‹ä»¶ç›‘å¬å™¨
                this.collapseBtn.removeEventListener('click', () => this.collapse());
                this.nextBtn.removeEventListener('click', () => this.nextPage());
                this.prevBtn.removeEventListener('click', () => this.prevPage());
                this.useBtn.removeEventListener('click', () => this.useDice());
                this.itemIcon.removeEventListener('click', (e) => this.handleHiddenFeatureClick(e));
                this.minimizedIcon.removeEventListener('click', () => this.expand());
                
                // ç§»é™¤å·¥å…·æç¤º
                this.hideTooltip();
                
                // ç§»é™¤å¯¹è¯æ¡†
                if (this.dialogOverlay && this.dialogOverlay.parentNode) {
                    this.dialogOverlay.parentNode.removeChild(this.dialogOverlay);
                }
                
                // ç§»é™¤æœ€å°åŒ–å›¾æ ‡
                if (this.minimizedIcon && this.minimizedIcon.parentNode) {
                    this.minimizedIcon.parentNode.removeChild(this.minimizedIcon);
                }
                
                // ç§»é™¤æ’ä»¶å…ƒç´ 
                if (this.pluginEl && this.pluginEl.parentNode) {
                    this.pluginEl.parentNode.removeChild(this.pluginEl);
                }
                
                console.log('åƒç´ éª°å­æ’ä»¶å·²é”€æ¯');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ’ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–åƒç´ éª°å­æ’ä»¶åˆ°å³ä¸‹è§’
            window.dicePlugin = new PixelDicePlugin('#dicePluginContainer', {
                userName: 'è°ƒæŸ¥å‘˜',
                skillName: 'çµæ„Ÿ',
                skillValue: 50,
                extraText: ''
            });
        });
    </script>
</body>
</html>